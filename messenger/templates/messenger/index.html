<!--
 [Messenger] INDEX.HTML - Copyright (c) 2016 - Sean Bailey - All Rights Reserved
 Powered by Django (https://www.djangoproject.com/) - Not endorsed by Django

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

 Looking for source code? Check it out here: https://github.com/LuckehPickle/chat
-->
<!DOCTYPE html>
<html>
    <head>
        <title>{{ title }}</title>
        {% load staticfiles %}
        <meta charset="UTF-8">
        <meta name="theme-color" content="#3B3B3B">
        <meta name="msapplication-navbutton-color" content="#3B3B3B">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
        <link rel="icon" type="image/ico" href="{% static 'shared/favicon.ico' %}">
        <link href="{% static 'messenger/css/main.css' %}" type="text/css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <script src="//use.edgefonts.net/bebas-neue:n4.js"></script>
        {% load socketio_tags %}
        {% socketio %}
        <script>
            {% if channel_id != None %}
                window.channel_id = "{{ channel_id }}";
                window.is_group = {{ is_group|yesno:"true,false" }};
            {% endif %}
        </script>
    </head>
    <body>
        {% load messenger_tags %}
        <script src="{% static 'shared/js/mo.min.js' %}"></script>
        {% include 'shared/push-messages.html' %}
        {% include 'shared/nav.html' %}

        <!-- Modals -->
        <div class="modal-wrapper">
            {% include 'messenger/create.html' %}
        </div>

        <!-- Toolbar -->
        <div class="toolbar">
            <div class="mobile-tools">
                <i class="material-icons js-transit" data-transit-id="m-back">chevron_left</i>
                <p>This is a really long title</p>
                <i class="material-icons js-transit" data-transit-id="m-add_user">person_add</i>
                <i class="material-icons js-transit dropdown-trigger" data-transit-id="m-more" data-mobile id="more">more_vert</i>
                {% comment %}
                <ul class="dropdown">
                    <li><a href="/"><i class="material-icons">photo</i>Edit chat picture</a></li>
                    <li><a href="/"><i class="material-icons">title</i>Edit chat name</a></li>
                    <li><a href="/"><i class="material-icons">group</i>Edit participants</a></li>
                    <li><a href="/"><i class="material-icons">link</i>Get URL</a></li>
                    <li><a href="/"><i class="material-icons">gavel</i>Manage moderators</a></li>
                    <li><a href="/"><i class="material-icons">gavel</i>View commands</a></li>
                    <li><a href="/"><i class="material-icons">exit_to_app</i>Leave chat</a></li>
                </ul>
                {% endcomment %}
            </div>

            <!-- DESKTOP TOOLS -->
            <div class="desktop-tools">
                <div class="tool-container" style="margin-right:10px;">
                    <span style="padding-right:5px;">
                        Create Group
                        <i class="material-icons">keyboard_arrow_down</i>
                    </span>
                    <link class="rippleJS"/>
                    <ul class="tool-container-dropdown">
                        <li class="create-group-trigger">Private Group</li>
                        <li class="create-group-trigger">Public Group</li>
                    </ul>
                </div>

                <!-- SEARCH -->
                <div class="tools-input-wrapper">
                    <i class="material-icons noselect">search</i>
                    <input type="text" spellcheck="false" placeholder="Search...">
                    <!-- DROPDOWN -->
                    <div class="tools-input-dropdown">
                        <section class="dropdown-users">
                            <p class="dropdown-title">Users</p>
                            <p class="dropdown-no-results">No results found.</p>
                        </section>
                        <section class="dropdown-pages">
                            <p class="dropdown-title">Docs</p>
                            <p class="dropdown-no-results">No results found.</p>
                        </section>
                        <section>
                            <a class="dropdown-silent">
                                See all results
                                <link class="rippleJS">
                            </a>
                        </section>
                    </div>
                </div>

                <!-- CHAT TITLE -->
                <p class="chat-title">
                    {% if chat_title != None %}
                        {{ chat_title }}
                        <span class="chat-nick">
                            {% if chat_nick != None %}
                                ({{ chat_nick }})
                            {% endif %}
                        </span>
                    {% else %}
                        No channel
                    {% endif %}
                </p>

                {% if is_group %}
                    <div class="tool-container">
                        <span>Add Users</span>
                        <link class="rippleJS"/>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Chat Wrap -->
        <div class="chat-wrap">
            <div class="chat-area">

                <div class="chat-area-left">
                    <!-- TABS HEAD -->
                    <div class="tab-heads">
                        <!-- TODO Store active tab in cookes -->
                        <div class="tab-head noselect" data-tab="friends" {% if not is_group %}active{% endif %}>Friends</div>
                        <div class="tab-head noselect" data-tab="groups" {% if is_group %}active{% endif %}>Groups</div>
                    </div>

                    <!-- FRIENDS LIST -->
                    <div class="tab-body tab-friends" {% if not is_group %}active{% endif %}>
                        {% if request.user.friends.count != 0 %}
                            {% for friend in request.user.friends.all|sort_by:"-is_online" %}
                                <div class="friend-container" data-url="{{ friend.get_absolute_url }}" {% if not is_group and friend.user_url in channel_id %}active{% endif %}>
                                    <div class="friend-image"></div>
                                    <div>
                                        <p class="friend-username">{{ friend.username }} {% comment "TODO" %}{{ friend.nickname }}{% endcomment %}</p>
                                        <p class="friend-tag">Beta-Tester</p> <!-- TODO Allow custom tags -->
                                    </div>
                                    <div class="friend-status-{% if friend.is_online %}online{% else %}offline{% endif %}"></div>
                                    <link class="rippleJS"/>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-friends">
                                 Looks like you don't have any friends yet.
                                 <img src="{% static 'messenger/img/tutorial_users.gif' %}">
                            </div>
                        {% endif %}
                    </div>

                    <!-- GROUPS LIST -->
                    <div class="tab-body tab-groups" {% if is_group %}active{% endif %}>
                        {% if request.user.groups.count != 0 %}
                            {% for group in request.user.groups.all|sort_by:"-last_message" %}
                                <div class="group-container" data-url="{{ group.get_absolute_url }}" {% if is_group and channel_id == group.group_id %}active{% endif %}>
                                    <div class="group-image"></div>
                                    <section>
                                        <p class="group-name">{{ group.name }}</p>
                                        <p class="group-message">{{ group.get_latest_message }}</p>
                                    </section>
                                    <link class="rippleJS"/>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-groups">
                                Looks like your not in any groups yet. Create one by clicking 'Create Group' on the toolbar above.
                                <img src="{% static 'messenger/img/tutorial_groups.gif' %}">
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Chat -->
                <div class="chat">
                    <!-- Chat Body -->
                    <div class="chat-body">
                        {% if last_fifteen_messages != None %}
                            {% for message in last_fifteen_messages reversed %}
                                {% with other=message|is_other:request.user.user_id %}
                                    <div class="chat-message-container{{ other }}">
                                        <div class="chat-message-image{{ other }}"></div>
                                        <span class="triangle-top-{% if message|is_other:request.user.user_id == "" %}left{% else %}right{% endif %}"></span>
                                        <section>
                                            <div class="chat-message-content{{ other }}">{{ message.contents }}</div>
                                        </section>
                                        <p class="chat-message-sender{{ other }}">{{ message.sender }} ({{ message.time_sent|date:"H:i" }})</p>
                                    </div>
                                {% endwith %}
                            {% endfor %}
                        {% else %}
                            No messages TODO make this fancy
                        {% endif %}
                    </div>

                    <!-- Chat Footer -->
                    <div class="chat-footer">
                        <form class="chat-form" novalidate{% if group_id == None and user_url == None %} disabled{% endif %}>
                            <div class="chat-form-input" contenteditable="true"></div>
                            <div class="chat-send">
                                <i class="material-icons">send</i>
                                <link class="rippleJS"/>
                            </div>
                            <input type="submit"><!-- Hidden, allows users to press 'enter' -->
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compressed Footer -->
        <div class="compact-footer">
            <div>Copyright © 2016 - Sean Bailey - All Rights Reserved</div>
        </div>

        <script src="{% static 'shared/js/nav.js' %}"></script>
        <script src="{% static 'shared/js/jquery-2.2.2.min.js' %}"></script>
        <script src="{% static 'messenger/js/messenger.js' %}"></script>
        <script src="https://cdn.rawgit.com/samthor/rippleJS/v1.0.2/ripple.min.js"></script>
    </body>
</html>
